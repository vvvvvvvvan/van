<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>我们的爱情清单 · 增强版</title>
<style>
  /* ===== 基础与背景 ===== */
  html, body {
    margin: 0;
    padding: 0;
    width: 100vw;
    min-height: 100vh;
    font-family: 'PingFang SC', 'Microsoft YaHei', Arial, sans-serif;
    overflow-x: hidden;
    background: #a9e3fe url('blue-bg.jpg') no-repeat center center fixed;
    background-size: cover;
  }
  body { position: relative; }

  a.back-arrow {
    position: fixed;
    top: 20px;
    left: 20px;
    font-size: 28px;
    color: white;
    text-decoration: none;
    z-index: 20;
    font-weight: bold;
  }
  a.back-arrow:hover { opacity: .75; }

  /* ===== 容器 ===== */
  .main-content {
    margin-top: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 100vw;
  }
  .main-box {
    background: rgba(255,255,255,0.95);
    box-shadow: 0 4px 16px rgba(84,179,250,0.14);
    border-radius: 20px;
    padding: 30px 0 22px 0;
    text-align: center;
    z-index: 5;
    margin-top: 40px;
    margin-bottom: 22px;
    width: 50vw;
    min-width: 300px;
    max-width: 560px;
    border: 1.5px solid #a6d6fc;
  }

  /* ===== 标题与头像 ===== */
  .love-title-wrapper {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 24px;
    margin-bottom: 14px;
    flex-wrap: wrap;
  }
  .love-title {
    font-size: 2em;
    font-weight: 800;
    color: #1759b9;
    letter-spacing: 4px;
  }
  .love-tip {
    font-size: 1.06em;
    color: #2c6ed5;
    margin-bottom: 14px;
    letter-spacing: 1px;
  }
  .avatar-inline { display: flex; flex-direction: column; align-items: center; text-decoration: none; }
  .avatar-img-inline { width: 60px; height: 60px; border-radius: 50%; object-fit: cover; box-shadow: 0 2px 6px rgba(0,0,0,0.2); }
  .avatar-name-inline { font-size: .9em; color: rgb(92,148,217); font-weight: bold; margin-top: 4px; text-shadow: 0 0 4px rgba(0,0,0,.3); }

  /* ===== 进度条 ===== */
  .progress-wrap { width: 92%; margin: 0 auto 10px auto; text-align: left; }
  .progress-row { display: flex; align-items: baseline; justify-content: space-between; gap: 12px; }
  .progress-text { color: #195cab; font-size: 1em; font-weight: bold; letter-spacing: 1px; }
  .progress-pct { color: #1167d1; font-weight: 800; }
  .progress-bar { background: #e0f1ff; border-radius: 16px; height: 15px; width: 100%; overflow: hidden; margin: 6px 0 4px 0; }
  .progress-inner { background: linear-gradient(90deg, #51bbfe 0%, #1e90ff 100%); height: 100%; border-radius: 16px; transition: width .35s ease; }

  /* ===== 列表 ===== */
  ul.love-list { list-style: none; padding: 0; margin: 8px auto 0; width: 92%; max-height: clamp(220px, 52vh, 520px); overflow-y: auto; box-sizing: border-box; scroll-behavior: smooth; }
  ul.love-list::-webkit-scrollbar { width: 8px; background: #e0f1ff; border-radius: 8px; }
  ul.love-list::-webkit-scrollbar-thumb { background: #b3d9fa; border-radius: 8px; }
  ul.love-list li { background: rgba(247,250,255,0.9); margin: 10px 0; border-radius: 12px; display: flex; align-items: center; justify-content: space-between; gap: 14px; padding: 12px 14px; box-shadow: 0 2px 8px rgba(84,179,250,0.09); font-size: 1.06em; border: 1.2px solid #a6d6fc; }
  ul.love-list li.done { background: #e7f7ed; color: #0f7a2c; text-decoration: line-through; opacity: .95; border-color: #9bd3ad; }

  /* ===== 按钮（可访问 + 触控友好） ===== */
  .toggle-btn { border: none; outline: none; font-size: .98em; padding: 9px 14px; border-radius: 14px; cursor: pointer; font-weight: 700; min-height: 40px; min-width: 92px; box-shadow: 0 2px 6px rgba(33,150,243,.10); transition: transform .08s ease, box-shadow .18s ease; }
  .toggle-btn:active { transform: translateY(1px); }
  .toggle-btn.todo { background: #1976d2; color: #fff; }
  .toggle-btn.todo:hover { background: #1e90ff; }
  .toggle-btn.done { background: #21a366; color: #fff; }
  .toggle-btn.done:hover { filter: brightness(1.05); }
  .toggle-btn:focus-visible { outline: 3px solid #b0ddfd; outline-offset: 2px; }

  /* ===== 顶部操作区 ===== */
  .toolbar { width: 92%; margin: 8px auto 2px; display: flex; flex-wrap: wrap; gap: 10px; align-items: center; justify-content: flex-end; }
  .toolbar button, .toolbar label { background: rgba(255,255,255,.9); border: 1px solid #a6d6fc; padding: 8px 12px; border-radius: 12px; color: #1b63c0; font-weight: 700; cursor: pointer; box-shadow: 0 2px 6px rgba(84,179,250,.08); }
  .toolbar input[type="file"] { display: none; }
  .toolbar button:hover, .toolbar label:hover { background: #e6f5ff; }

  /* ===== 画布动画 ===== */
  #sakuraCanvas { position: fixed; left: 0; top: 0; width: 100vw; height: 100vh; pointer-events: none; z-index: 10; }

  @media (max-width: 900px) {
    .main-box { width: 84vw; }
    ul.love-list { width: 98%; }
  }
  @media (max-width: 600px) {
    .main-box { width: 98vw; min-width: 0; padding: 16px 0 12px 0; }
    .love-title { font-size: 1.22em; }
    .love-tip { font-size: .98em; }
    .progress-text { font-size: .95em; }
    ul.love-list { max-height: min(48vh, 360px); }
    ul.love-list li { font-size: .98em; padding: 10px 10px; }
    .toggle-btn { font-size: .95em; padding: 8px 12px; min-width: 86px; }
  }
</style>
</head>
<body>
  <a class="back-arrow" href="index.html" aria-label="返回首页">←</a>
  <canvas id="sakuraCanvas" aria-hidden="true"></canvas>

  <div class="main-content">
    <div class="main-box" role="region" aria-labelledby="title">
      <div class="love-title-wrapper">
        <a class="avatar-inline" href="index.html">
          <img alt="van" class="avatar-img-inline" src="A62A07FD46CF3AE4F9EA92855966E5E7.jpg"/>
          <div class="avatar-name-inline">van</div>
        </a>
        <h1 id="title" class="love-title">我们的爱情清单</h1>
        <a class="avatar-inline" href="index.html">
          <img alt="smader" class="avatar-img-inline" src="F0EA2A563C8A66514D51753ADA28B318.jpg"/>
          <div class="avatar-name-inline">smader</div>
        </a>
      </div>

      <p class="love-tip">除了这些以外，还有好多好多事情想和你一起做</p>

      <div class="progress-wrap">
        <div class="progress-row">
          <div class="progress-text" id="progress-text" aria-live="polite">已完成 0 / 0</div>
          <div class="progress-pct" id="progress-pct">0%</div>
        </div>
        <div class="progress-bar" aria-hidden="true">
          <div class="progress-inner" id="progress-inner" style="width:0%"></div>
        </div>
      </div>

      <div class="toolbar" aria-label="操作">
        <button id="exportBtn" type="button">导出进度</button>
        <label for="importFile" title="从 JSON 导入">导入进度</label>
        <input id="importFile" type="file" accept="application/json" />
        <button id="resetBtn" type="button">重置</button>
      </div>

      <ul class="love-list" id="love-list" aria-label="清单">
        <!-- 动态插入清单项 -->
      </ul>
    </div>
  </div>

<script>
  // ===== 樱花飘落（根据设备能力自适应数量） =====
  const sakuraCanvas = document.getElementById('sakuraCanvas');
  let W = window.innerWidth, H = window.innerHeight;
  sakuraCanvas.width = W; sakuraCanvas.height = H;
  const sctx = sakuraCanvas.getContext('2d');

  function rnd(min, max){ return Math.random() * (max - min) + min; }
  class Sakura {
    constructor(){ this.reset(); }
    reset(){
      this.x = rnd(0, W);
      this.y = rnd(-50, H * 0.6);
      this.r = rnd(6, 14);
      this.a = rnd(0, Math.PI*2);
      this.v = rnd(1.0, 2.0);
      this.ra = rnd(0.007, 0.017);
      this.op = rnd(0.6, 0.9);
      this.sa = rnd(0, Math.PI*2);
      this.sv = rnd(0.008, 0.016);
      this.color = `rgba(${Math.floor(rnd(170,210))},${Math.floor(rnd(220,240))},255,${this.op})`;
    }
    update(){
      this.y += this.v;
      this.a += this.ra;
      this.sa += this.sv;
      this.x += Math.sin(this.sa) * 0.7;
      if(this.y > H + 30 || this.x < -30 || this.x > W + 30){ this.reset(); this.y = -30; }
    }
    draw(){
      sctx.save(); sctx.translate(this.x, this.y); sctx.rotate(this.a);
      for(let i=0;i<5;i++){
        sctx.rotate(Math.PI*2/5);
        sctx.beginPath();
        sctx.moveTo(0,0);
        sctx.quadraticCurveTo(this.r*0.45,-this.r*0.1,this.r*0.6,-this.r*0.8);
        sctx.quadraticCurveTo(0,-this.r*0.7,-this.r*0.6,-this.r*0.8);
        sctx.quadraticCurveTo(-this.r*0.45,-this.r*0.1,0,0);
        sctx.closePath();
        sctx.fillStyle = this.color;
        sctx.shadowColor = '#c7e7ff';
        sctx.shadowBlur = 8;
        sctx.fill();
      }
      sctx.restore();
    }
  }

  let sakuras = [];
  function computeSakuraCount(){
    const dpr = Math.min(window.devicePixelRatio || 1, 2);
    const cores = (navigator.hardwareConcurrency || 4);
    const base = 36;
    // 低性能：少一些；高性能：多一些（上限 60）
    let count = Math.round(base * (cores >= 8 ? 1.2 : cores <= 4 ? 0.8 : 1.0) * (dpr > 1.5 ? 1.1 : 1.0));
    return Math.max(20, Math.min(60, count));
  }
  function createSakuras(){
    sakuras = []; const n = computeSakuraCount();
    for(let i=0;i<n;i++) sakuras.push(new Sakura());
  }
  function animate(){
    sctx.clearRect(0,0,W,H);
    for(const s of sakuras){ s.update(); s.draw(); }
    requestAnimationFrame(animate);
  }
  createSakuras(); animate();
  window.addEventListener('resize', () => { W = window.innerWidth; H = window.innerHeight; sakuraCanvas.width = W; sakuraCanvas.height = H; createSakuras(); });

  // ===== 清单数据 =====
  const loveListData = [
    {"text":"一起看日出","done":true},
    {"text":"一起在海边散步","done":true},
    {"text":"一起看日落","done":true},
    {"text":"一起看一场流星雨","done":false},
    {"text":"一起养一盆绿植","done":false},
    {"text":"一起逛博物馆","done":true},
    {"text":"一起做志愿者","done":true},
    {"text":"一起学习新语言","done":false},
    {"text":"一起看一场话剧","done":false},
    {"text":"一起去植物园赏花","done":false},
    {"text":"一起制作手工礼物","done":true},
    {"text":"一起挑战密室逃脱","done":false},
    {"text":"一起学习摄影技巧","done":false},
    {"text":"一起去户外烧烤","done":false},
    {"text":"一起滑雪","done":false},
    {"text":"一起放风筝","done":true},
    {"text":"一起制作情侣相册","done":true},
    {"text":"一起体验潜水","done":false},
    {"text":"一起学习乐器","done":false},
    {"text":"一起去天文台观星","done":false},
    {"text":"一起参加音乐节","done":false},
    {"text":"一起爬长城","done":false},
    {"text":"一起挑战户外徒步","done":true},
    {"text":"一起烘培糕点","done":false},
    {"text":"一起体验热气球之旅","done":false},
    {"text":"一起制作情侣对戒","done":true},
    {"text":"一起玩卡丁车","done":false},
    {"text":"一起学习书法","done":false},
    {"text":"一起参加户外骑行","done":true},
    {"text":"一起抓娃娃","done":true},
    {"text":"一起体验冲浪","done":false},
    {"text":"一起插花","done":false},
    {"text":"一起去寺庙","done":true},
    {"text":"一起玩鬼屋","done":true},
    {"text":"打一场枕头大战","done":false},
    {"text":"一起去漂流","done":false},
    {"text":"一起去天安门看国旗","done":false},
    {"text":"一起吃烛光晚餐","done":true},
    {"text":"一起泡温泉","done":false},
    {"text":"一起制作情侣手链","done":false},
    {"text":"一起刮彩票","done":true},
    {"text":"一起户外露营","done":false},
    {"text":"一起坐一次随机公交","done":false},
    {"text":"一起去脱口秀","done":false},
    {"text":"一起划船","done":false},
    {"text":"一起放孔明灯","done":false},
    {"text":"一起去网吧","done":true},
    {"text":"为对方按摩","done":true},
    {"text":"一起去法院听公开案","done":false},
    {"text":"一起体验滑翔伞","done":false},
    {"text":"一起做情侣瑜伽","done":false},
    {"text":"一起敷面膜","done":false},
    {"text":"一起玩过山车","done":true},
    {"text":"一起逛公园","done":true},
    {"text":"一起去酒吧","done":false},
    {"text":"为对方调一杯酒","done":true},
    {"text":"给对方化妆","done":false},
    {"text":"一起探访深夜小吃","done":true},
    {"text":"一起自驾周边古镇","done":false},
    {"text":"一起坐轮渡","done":true},
    {"text":"一起穿情侣装","done":true},
    {"text":"唱歌给对方听","done":true},
    {"text":"一起看足球比赛","done":true},
    {"text":"一起拼乐高","done":false},
    {"text":"一起调香水","done":false},
    {"text":"一起游泳","done":false},
    {"text":"一起庆祝纪念日","done":true},
    {"text":"一起聊八卦","done":true},
    {"text":"一起跨年","done":true},
    {"text":"一起放烟花","done":false},
    {"text":"一起养一只宠物","done":false},
    {"text":"一起坐摩天轮","done":false},
    {"text":"一起看书","done":true},
    {"text":"一起用情侣手机壳","done":true},
    {"text":"一起打扑克","done":true},
    {"text":"一起去一次教堂","done":false},
    {"text":"去对方学校看看","done":false},
    {"text":"偷偷买对方喜欢但又舍不得的东西","done":true},
    {"text":"一起看樱花","done":false},
    {"text":"一起画一组情头","done":false},
    {"text":"一起通关一个双人游戏","done":false},
    {"text":"一起做早餐","done":false},
    {"text":"一起看雪","done":false},
    {"text":"去对方家所在的城市","done":false},
    {"text":"一起摘樱桃","done":false},
    {"text":"一起大扫除","done":false},
    {"text":"一起追一部剧","done":true},
    {"text":"一起创建一个共享歌单","done":true},
    {"text":"一起看电影","done":true},
    {"text":"一起逛家具店","done":true},
    {"text":"一起听歌","done":true},
    {"text":"一起逛超市","done":true},
    {"text":"一起打高尔夫","done":true},
    {"text":"给对方吹头发","done":true},
    {"text":"一起打台球","done":true},
    {"text":"给对方送花","done":true},
    {"text":"一起跑步","done":true},
    {"text":"一起晚饭后散步","done":true},
    {"text":"一起吃火锅","done":true},
    {"text":"一起做一个网站","done":true}
  ];

  // ===== 本地存储 =====
  const STORAGE_KEY = 'loveListStatus_v2_lovecabin';
  function loadStatus(){
    try{
      const data = JSON.parse(localStorage.getItem(STORAGE_KEY));
      if(Array.isArray(data) && data.length === loveListData.length){ return data; }
    }catch(e){ /* ignore */ }
    return loveListData.map(x => x.done);
  }
  function saveStatus(arr){ localStorage.setItem(STORAGE_KEY, JSON.stringify(arr)); }

  // ===== 渲染 =====
  const listEl = document.getElementById('love-list');
  const progressTextEl = document.getElementById('progress-text');
  const progressPctEl = document.getElementById('progress-pct');
  const progressBarEl = document.getElementById('progress-inner');

  function render(){
    const status = loadStatus();
    listEl.innerHTML = '';
    let doneCount = 0;
    for(let i=0;i<loveListData.length;i++){
      if(status[i]) doneCount++;
      const li = document.createElement('li');
      li.className = status[i] ? 'done' : '';
      const span = document.createElement('span');
      span.textContent = loveListData[i].text;
      const btn = document.createElement('button');
      const isDone = !!status[i];
      btn.className = `toggle-btn ${isDone ? 'done' : 'todo'}`;
      btn.textContent = isDone ? '已完成' : '未完成';
      btn.setAttribute('aria-pressed', String(isDone));
      btn.setAttribute('aria-label', `${loveListData[i].text} 标记为${isDone ? '已完成' : '未完成'}`);
      btn.addEventListener('click', () => {
        status[i] = !status[i];
        saveStatus(status);
        render();
      });
      li.appendChild(span);
      li.appendChild(btn);
      listEl.appendChild(li);
    }
    const pct = loveListData.length ? Math.round(100*doneCount/loveListData.length) : 0;
    progressTextEl.textContent = `已完成 ${doneCount} / ${loveListData.length}`;
    progressPctEl.textContent = `${pct}%`;
    progressBarEl.style.width = pct + '%';
  }

  render();

  // ===== 导出 / 导入 / 重置 =====
  document.getElementById('exportBtn').addEventListener('click', () => {
    const data = localStorage.getItem(STORAGE_KEY) || '[]';
    const blob = new Blob([data], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = 'love-list-progress.json';
    a.click(); URL.revokeObjectURL(url);
  });

  const importFile = document.getElementById('importFile');
  importFile.addEventListener('change', (e) => {
    const file = e.target.files && e.target.files[0];
    if(!file) return;
    const reader = new FileReader();
    reader.onload = () => {
      try{
        const parsed = JSON.parse(reader.result);
        if(Array.isArray(parsed) && parsed.length === loveListData.length){
          localStorage.setItem(STORAGE_KEY, JSON.stringify(parsed));
          render();
          alert('导入成功');
        }else{
          alert('导入失败：数据长度不匹配');
        }
      }catch(err){ alert('导入失败：JSON 解析错误'); }
      importFile.value = '';
    };
    reader.readAsText(file);
  });

  document.getElementById('resetBtn').addEventListener('click', () => {
    if(confirm('确定要重置所有进度吗？')){
      localStorage.removeItem(STORAGE_KEY);
      render();
    }
  });
</script>
</body>
</html>